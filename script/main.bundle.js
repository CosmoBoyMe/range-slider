(()=>{"use strict";class t{constructor(t,e){this.modelInstance=t,this.viewInstance=e,this.bind()}getModelInstance(){return this.modelInstance}getViewInstance(){return this.viewInstance}bind(){this.modelInstance.subscribe("OPTIONS_CHANGED",(t=>{this.viewInstance.updateOptions(t)})),this.viewInstance.subscribe("UPDATE_VALUE",(t=>{this.modelInstance.updateValue(t)})),this.modelInstance.subscribe("VALUE_UPDATED",(t=>{this.viewInstance.updateValue(t)}))}}const e=(t,e,s,n)=>{if(s<=t)return t;if(s>=e)return e;const i=Math.abs(t-s),l=t+n*Math.round(i/n);return Math.round(100*l)/100},s=(t,e,s)=>(t-e)/(s-e)*100;class n{constructor(){this.observers={}}getObservers(){return this.observers}subscribe(t,e){this.observers[t]?this.observers[t].push(e):this.observers[t]=[e]}notify(t,e){return!!this.observers[t]&&(this.observers[t].forEach((t=>t(e))),!0)}}const i={min:0,max:10,step:1,scaleCounts:11,values:[5,6],vertical:!0,scale:!0,tooltip:!0,progress:!0};class l extends n{constructor(t){super(),this.options=Object.assign(Object.assign({},i),t),this.init()}getOptions(){const{options:t}=this;return JSON.parse(JSON.stringify(t))}updateValue({value:t,index:e}){this.options.values[e]=t;const s=this.options.values[e];this.notify("VALUE_UPDATED",{value:s,index:e})}updateOptions(t){this.options=Object.assign(Object.assign({},this.options),t),this.normalizeOptions(),this.notify("OPTIONS_CHANGED",this.options)}init(){this.normalizeOptions()}normalizeOptions(){this.normalizeMax(),this.normalizeScaleCounts(),this.normalizeStep(),this.normalizeValues()}normalizeScaleCounts(){const{min:t,max:e,step:s,scaleCounts:n}=this.options,i=Math.abs(e-t)/s+1,l=Math.round(i<n?i:n);this.options.scaleCounts=l}normalizeMax(){const{min:t,max:e,step:s}=this.options;t>e&&(this.options.max=t+s),t===e&&(this.options.max=t+s)}normalizeValues(){const{min:t,max:s,step:n,values:i}=this.options,l=i.map((i=>e(t,s,i,n)));this.options.values=l}normalizeStep(){const{step:t,min:e,max:s}=this.options,n=Math.abs(s-e);0===t?this.options.step=1:t>n&&(this.options.step=n)}}class a{constructor({element:t,isVertical:e,handleTrackClick:s}){this.trackElement=document.createElement("div"),this.element=t,this.handleTrackClick=s,this.isVertical=e,this.render()}getElement(){return this.trackElement}toggleVeticalClass(){this.trackElement.classList.toggle("js-track--vertical")}destroy(){this.trackElement.remove()}render(){const{trackElement:t,element:e}=this;t.classList.add("js-track"),t.addEventListener("click",this.handleTrackClick),this.isVertical&&this.toggleVeticalClass(),e.append(t)}}class o{constructor({rootElement:t,values:e,min:s,max:n,range:i,vertical:l}){this.progressEl=document.createElement("div"),this.rootElement=t,this.values=e,this.min=s,this.max=n,this.range=i,this.vertical=l,this.init()}updateValues(t){this.values=t,this.updateProgressLenght(),this.updatePosition()}destroy(){this.progressEl.remove()}getElement(){return this.progressEl}updateProgressLenght(){const{progressEl:t,values:e,min:n,max:i,range:l,vertical:a}=this;let o;if(l){const t=Math.min(...e),l=Math.max(...e),a=s(t,n,i);o=s(l,n,i)-a}else o=s(e[0],n,i);a?t.style.height=`${o}%`:t.style.width=`${o}%`}toggleVerticalClass(){const{progressEl:t,vertical:e}=this;e?t.classList.add("js-progress--vertical"):t.classList.remove("js-progress--vertical")}updatePosition(){const{min:t,max:e,values:n,progressEl:i,range:l,vertical:a}=this;if(l){const l=Math.min(...n),o=s(l,t,e);a?i.style.bottom=`${o}%`:i.style.left=`${o}%`}else a?i.style.bottom="0%":i.style.left="0%"}init(){const{progressEl:t}=this;t.classList.add("js-progress"),this.updateProgressLenght(),this.updatePosition(),this.rootElement.append(t),this.toggleVerticalClass()}}class r{constructor({rootDom:t,min:e,max:s,step:n,scaleCounts:i,vertical:l,handleScaleClick:a}){this.scaleEl=document.createElement("div"),this.rootDom=t,this.min=e,this.max=s,this.step=n,this.vertical=l,this.scaleCounts=i,this.handleScaleClick=a,this.render()}destroy(){this.scaleEl.remove()}getElement(){return this.scaleEl}createScalePoint(t){const{min:e,max:n,vertical:i}=this,l=document.createElement("div");l.classList.add("js-scale__point"),l.innerHTML=String(t);const a=s(t,e,n);return i?(l.classList.add("js-scale__point--vertical"),l.style.bottom=`${a}%`):l.style.left=`${a}%`,l}getScaleValues(){const{min:t,max:s,scaleCounts:n,step:i}=this,l=[],a=n-1,o=(s-t)/a;for(let n=0;n<=a;n+=1){let r;r=n===a?s:e(t,s,t+o*n,i),l.push(r)}return l}deleteScalePointsWhenPointOverlap(){const{scaleEl:t}=this,e=[...t.children];e.forEach(((s,n)=>{const i=s.getBoundingClientRect();for(let s=n+1;s<e.length;s+=1){const n=e[s],l=n.getBoundingClientRect();!(i.top>l.bottom||i.right<l.left||i.bottom<l.top||i.left>l.right)&&t.contains(n)&&t.removeChild(n)}}))}render(){const{rootDom:t,scaleEl:e,scaleCounts:s,vertical:n}=this;e.classList.add("js-scale"),n&&e.classList.add("js-scale--vertical");const i=this.getScaleValues(),l=[];for(let t=0;t<s;t+=1){const e=this.createScalePoint(i[t]);l.push(e)}e.append(...l),e.addEventListener("click",this.handleScaleClick),t.append(e),this.deleteScalePointsWhenPointOverlap()}}class c{constructor({rootElement:t,value:e,isVertical:s}){this.tooltipEl=document.createElement("div"),this.rootElement=t,this.value=e,this.isVertical=s,this.render()}destroy(){this.tooltipEl.remove()}getElement(){return this.tooltipEl}updateValue(t){this.value=t,this.updateInnerText()}toggleVerticalClass(){this.tooltipEl.classList.toggle("js-tooltip--vertical")}updateInnerText(){this.tooltipEl.textContent=String(this.value)}render(){const{tooltipEl:t}=this;t.classList.add("js-tooltip"),t.textContent=String(this.value),this.isVertical&&this.toggleVerticalClass(),this.rootElement.append(t)}}class h{constructor({rootElement:t,value:e,min:s,max:n,handleThumbPointerDown:i,index:l,isVertical:a,enableTooltip:o}){this.thumbEl=document.createElement("div"),this.tooltipInstance=null,this.rootElement=t,this.value=e,this.min=s,this.max=n,this.handleThumbPointerDown=i,this.index=l,this.enableTooltip=o,this.isVertical=a,this.enableTooltip&&(this.tooltipInstance=new c({rootElement:this.thumbEl,value:e,isVertical:a})),this.render()}getElement(){return this.thumbEl}destroy(){this.thumbEl.remove()}getValue(){return this.value}updateValue(t){this.value=t,this.tooltipInstance&&this.tooltipInstance.updateValue(t),this.updatePosition()}updatePosition(){const{value:t,min:e,max:n,isVertical:i,thumbEl:l}=this;i?l.style.bottom=`${s(t,e,n)}%`:l.style.left=`${s(t,e,n)}%`}toggleVerticalClass(){this.thumbEl.classList.toggle("js-thumb--vertical")}render(){const{rootElement:t,thumbEl:e,handleThumbPointerDown:s,index:n,isVertical:i}=this;e.classList.add("js-thumb"),i&&this.toggleVerticalClass(),this.updatePosition(),e.addEventListener("pointerdown",(t=>s(t,n))),t.append(e)}}class u extends n{constructor(t,e){super(),this.sliderElement=document.createElement("div"),this.track=null,this.thumbsInstance=[],this.progessInstance=null,this.scaleInstance=null,this.sliderElement.classList.add("js-custom-slider"),t.append(this.sliderElement),this.options=e,this.render()}getAllInstance(){return{track:this.track,thumbs:this.thumbsInstance,progress:this.progessInstance,scale:this.scaleInstance}}updateValue({value:t,index:e}){this.options.values[e]=t,this.thumbsInstance[e].updateValue(t),this.progessInstance&&this.progessInstance.updateValues(this.options.values)}updateOptions(t){this.options=t,this.destroyAllInstances(),this.render()}getOptions(){return this.options}getSliderElement(){return this.sliderElement}getCurrentValueFromCoords(t,s){const{min:n,max:i,step:l,vertical:a}=this.options,o=a?s:t,r=a?this.sliderElement.getBoundingClientRect().bottom:this.sliderElement.getBoundingClientRect().left,c=a?this.sliderElement.offsetHeight:this.sliderElement.offsetWidth;let h=a?r-o:o-r;return h<0&&(h=0),h>c&&(h=c),e(n,i,h/(c/100)*(i-n)/100+n,l)}destroyAllInstances(){var t,e,s,n;null===(t=this.track)||void 0===t||t.destroy(),null===(e=this.progessInstance)||void 0===e||e.destroy(),this.thumbsInstance.forEach((t=>t.destroy())),null===(s=this.scaleInstance)||void 0===s||s.destroy(),null===(n=this.progessInstance)||void 0===n||n.destroy()}handleThumbPointerDown(t,e){t.preventDefault();const s=({clientX:t,clientY:s})=>{const n=this.getCurrentValueFromCoords(t,s);n!==this.options.values[e]&&this.notify("UPDATE_VALUE",{value:n,index:e})},n=()=>{document.removeEventListener("pointerup",n),document.removeEventListener("pointermove",s)};document.addEventListener("pointermove",s),document.addEventListener("pointerup",n);const{target:i}=t;i&&(i.ondragstart=()=>!1)}handleTrackClick(t){const{clientX:e,clientY:s}=t,n=this.getCurrentValueFromCoords(e,s);this.updateClickedValue(n)}handleScaleClick(t){const{target:e}=t;if(e){const t=Number(e.innerText);this.updateClickedValue(t)}}updateClickedValue(t){const{values:e}=this.options;let s=0;e.length>1&&(s=((t,e)=>{if(0===t.length)return-1;const s=t.reduce(((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t));return t.indexOf(s)})(e,t)),this.notify("UPDATE_VALUE",{value:t,index:s})}render(){const{min:t,max:e,step:s,values:n,scaleCounts:i,vertical:l,tooltip:c,scale:u,progress:d}=this.options,m=n.length>1;this.track=new a({element:this.sliderElement,isVertical:l,handleTrackClick:this.handleTrackClick.bind(this)});const p=this.track.getElement();d&&(this.progessInstance=new o({rootElement:p,values:n,min:t,max:e,range:m,vertical:l})),u&&(this.scaleInstance=new r({rootDom:this.sliderElement,min:t,max:e,step:s,scaleCounts:i,vertical:l,handleScaleClick:this.handleScaleClick.bind(this)})),this.thumbsInstance=n.map(((s,n)=>new h({rootElement:p,value:s,min:t,max:e,handleThumbPointerDown:this.handleThumbPointerDown.bind(this),index:n,isVertical:l,enableTooltip:c})))}}class d{constructor(e,s={}){this.modelInstance=new l(s);const n=this.modelInstance.getOptions();this.viewInstance=new u(e,n),this.preseneterInstance=new t(this.modelInstance,this.viewInstance)}updateOptions(t){this.modelInstance.updateOptions(t)}onChangeOptions(t){const e=()=>{t(this.getOptions())};this.modelInstance.subscribe("OPTIONS_CHANGED",e),this.modelInstance.subscribe("VALUE_UPDATED",e)}getOptions(){return this.modelInstance.getOptions()}}!function(t){t.fn.rangeSlider=function(e={}){const s=t(this).get(0);if(s)return new d(s,e)}}(jQuery);class m{constructor(t,e){this.panelEl=document.createElement("div"),this.rootElement=t,this.panelEl.classList.add("js-panel"),this.rootElement.append(this.panelEl),this.slider=e,this.options=e.getOptions(),this.slider.onChangeOptions(this.onChangeOptions.bind(this)),this.render()}handlerDeleteThumbBtnClick(t,e){const{values:s}=this.options,n=s.filter(((t,s)=>e!==s));this.options.values=n,this.slider.updateOptions(this.options)}handlerItemInputBlur(t,e,s){const n=t.target,{value:i}=n;"values"===e&&void 0!==s?(this.options.values[s]=Number(i),this.slider.updateOptions({[e]:this.options.values})):this.slider.updateOptions({[e]:Number(i)})}handlerItemCheckboxClick(t,e){const{options:s}=this;"boolean"==typeof s[e]&&(Object.defineProperty(s,e,{value:!s[e]}),this.slider.updateOptions(s))}handleAddNewThumbBtnClick(t,e){const{values:s}=this.options;s.push(e),this.slider.updateOptions({values:s})}createValuesInput({name:t,text:e,value:s,index:n}){const i=document.createElement("label");i.classList.add("js-panel__item");const l=document.createElement("input");l.classList.add("js-panel__item-input"),l.setAttribute("type","number"),l.setAttribute("data-values",String(s)),l.value=String(s),l.addEventListener("blur",(e=>this.handlerItemInputBlur(e,t,n)));const a=document.createElement("button");return a.classList.add("js-panel__delete-thumb-btn"),a.textContent="delete thumb",a.addEventListener("click",(t=>this.handlerDeleteThumbBtnClick(t,n))),i.append(e,l,a),i}createSwitchElement(t,e,s){const n=document.createElement("label");n.classList.add("js-panel__item");const i=document.createElement("input");return i.classList.add("js-panel__item-checkbox"),i.setAttribute("type","checkbox"),i.checked=s,i.setAttribute(`data-${t}`,String(s)),i.addEventListener("click",(e=>this.handlerItemCheckboxClick(e,t))),n.append(e,i),n}createNumberInputEl(t,e,s){const n=document.createElement("label");n.classList.add("js-panel__item");const i=document.createElement("input");return i.classList.add("js-panel__item-input"),i.setAttribute("type","number"),i.setAttribute(`data-${t}`,String(s)),i.value=String(s),i.addEventListener("blur",(e=>this.handlerItemInputBlur(e,t))),n.append(e,i),n}createNewThumbBlock(){const t=document.createElement("div"),e=document.createElement("h3");e.innerText="add new Value";const s=document.createElement("input");s.classList.add("js-panel__new-item_input"),s.setAttribute("type","number");const n=document.createElement("button");return n.classList.add("js-panel__add-new_thumb-btn"),n.innerText="+",n.addEventListener("click",(t=>{const e=Number(s.value);this.handleAddNewThumbBtnClick(t,e)})),s.setAttribute("type","number"),t.append(e,s,n),t}onChangeOptions(t){this.options=t,this.render()}render(){const t=Object.entries(this.options),e=[],s=document.createElement("div");s.classList.add("js-panel__switch-container"),t.forEach((([t,n])=>{if("boolean"==typeof n){const e=this.createSwitchElement(t,t,n);s.append(e)}else if("values"===t){const s=n.map(((e,s)=>this.createValuesInput({name:t,text:"value",value:e,index:s}))),i=this.createNewThumbBlock();e.push(...s,i)}else e.push(this.createNumberInputEl(t,t,n))})),this.panelEl.innerHTML="",this.panelEl.append(...e,s)}}const p=document.querySelectorAll(".demo"),v=[{tooltip:!1,progress:!1,scale:!1,vertical:!1},{min:-100,max:30,step:10,values:[10]},{min:-100,max:-10,step:.33,vertical:!1,scaleCounts:2,progress:!1,values:[-33.01,-55.12]},{min:-1e3,max:1e4,step:.33,scaleCounts:5,tooltip:!1,vertical:!1,scale:!0,values:[33,5e3,3e3,6534,4043]},{}];p.forEach(((t,e)=>{const s=t.querySelector(".slider"),n=$(s).rangeSlider(v[e]);new m(t,n)}))})();
//# sourceMappingURL=main.bundle.js.map